#summary Install Birt 2.2.2 web report engine to work with MIAC program
#labels birt,tomcat

== Required software ==


  # [http://www.eclipse.org/downloads/download.php?file=/birt/downloads/drops/R-R1-2_2_2-200802271210/birt-runtime-2_2_2.zip BIRT Report Engine]
  # [http://code.google.com/p/miac-jboss-config/downloads/list?q=label:birt VJDBC driver with EJB3 supports]
  # Apache tomcat 

== Download all needed software ==
{{{
export BIRT_DIST=/tmp/birt222
mkdir $BIRT_DIST
cd $BIRT_DIST

# BIRT 2.2.2
wget -c 'http://www.eclipse.org/downloads/download.php?file=/birt/downloads/drops/R-R1-2_2_2-200802271210/birt-runtime-2_2_2.zip&url=http://eclipse.i-logic.hu//birt/downloads/drops/R-R1-2_2_2-200802271210/birt-runtime-2_2_2.zip&mirror_id=70'

# VJDBC ejb3 data provider for MIAC
wget -c 'http://miac-jboss-config.googlecode.com/files/vjdbc3.ear'

# Russian transation for BIRT
mkdir -p /org/eclipse/birt/report/resource
wget -c http://miac-jboss-config.googlecode.com/files/Messages_ru_RU.properties -O /org/eclipse/birt/report/resource/Messages_ru_RU.properties

# vjdbc supports for BIRT
wget http://miac-jboss-config.googlecode.com/files/vjdbc.jar
wget http://miac-jboss-config.googlecode.com/files/vjdbc-context.jar
wget http://miac-jboss-config.googlecode.com/files/vjdbc-postgres.jar

# RIAMS war
cp ${SOMEPLACE}/riams.war .

}}}
== Install vjdbc application on jboss ==

{{{
JBOSS_HOME=/opt/jboss4.2.2-GA
cp ${$BIRT_DIST}/vjdbc3.ear ${JBOSS_HOME}/server/default/deploy/ecom/
}}}

== Install BIRT Report engine to tomcat ==
Extract birt-runtime-2_2_2.zip/birt-runtime-2_2_2/birt.war to ${TOMCAT_HOME}/webapps/birt
{{{
jar xf ${$BIRT_DIST}/birt-runtime-2_2_2.zip birt-runtime-2_2_2/birt.war
mkdir ${TOMCAT_HOME}/webapps/birt
cd ${TOMCAT_HOME}/webapps/birt
jar xf ${$BIRT_DIST}/birt-runtime-2_2_2/birt.war
}}}

== Transate to russian ==

Copy Messages_ru_RU.properties to ${TOMCAT_HOME}/webapps/birt/WEB-INF/lib/viewservlets.jar into /org/eclipse/birt/report/resource directory of this jar file
{{{
jar uf ${TOMCAT_HOME}/webapps/birt/WEB-INF/lib/viewservlets.jar ${BIRT_DIST}/org
}}}

== Install MIAC logon context ==

Copy /WEB-INF/lib/*.jar from riams.war to ${TOMCAT_HOME}/webapps/birt/WEB-INF/lib/
Note: do not copy js.jar
{{{
mkdir $BIRT_DIST/riams
cd $BIRT_DIST/riams
jar xf ../riams.war
rm $BIRT_DIST/riams/WEB-INF/lib/js.jar
cp WEB-INF/lib/*.jar ${TOMCAT_HOME}/webapps/birt/WEB-INF/lib/
}}}

Copy struts and dwr configs
{{{
cp $BIRT_DIST/riams/WEB-INF/config-ecom.xml ${TOMCAT_HOME}/webapps/birt/WEB-INF/
cp $BIRT_DIST/riams/WEB-INF/dwr-ecom.xml ${TOMCAT_HOME}/webapps/birt/WEB-INF/
}}}

Copy vjdbc supports for BIRT
{{{
cp $BIRT_DIST/vjdbc*.jar ${TOMCAT_HOME}/webapps/birt/WEB-INF/lib/
}}}

Copy jsp for logon screen
{{{
cp -R $BIRT_DIST/riams/WEB-INF/tiles ${TOMCAT_HOME}/webapps/birt/WEB-INF/
mkdir -p ${TOMCAT_HOME}/webapps/birt/WEB-INF/actions/ecom_login
cp $BIRT_DIST/riams/WEB-INF/actions/ecom_login/login.jsp ${TOMCAT_HOME}/webapps/birt/WEB-INF/actions/ecom_login
}}}

Copy riams version
{{{
cp $BIRT_DIST/riams/WEB-INF/buildnumber.txt ${TOMCAT_HOME}/webapps/birt/WEB-INF/
}}}

Append to the end of ${TOMCAT_HOME}/webapps/birt/WEB-INF/web.xml struts and vjdbc context configurations

{{{
    <!-- ECOM -->
    <!-- Struts mapping -->
    <!-- Struts servlet -->
    <servlet>
        <servlet-name>action</servlet-name>
        <servlet-class>org.apache.struts.action.ActionServlet</servlet-class>
        <init-param>
            <param-name>config</param-name>
            <param-value>/WEB-INF/config-ecom.xml</param-value>
        </init-param>
    </servlet>
    <servlet-mapping>
        <servlet-name>action</servlet-name>
        <url-pattern>*.do</url-pattern>
    </servlet-mapping>

    <!-- LOGIN -->
    <filter>
        <filter-name>Login</filter-name>
        <filter-class>ru.ecom.web.login.LoginFilter</filter-class>
    </filter>

    <filter-mapping>
        <filter-name>Login</filter-name>
        <servlet-name>ViewerServlet</servlet-name>
    </filter-mapping>
    <filter-mapping>
        <filter-name>Login</filter-name>
        <servlet-name>EngineServlet</servlet-name>
    </filter-mapping>
    <filter-mapping>
        <filter-name>Login</filter-name>
        <servlet-name>action</servlet-name>
    </filter-mapping>

    <!-- VJDBC COntext -->
    <filter>
        <filter-name>vjdbc-context</filter-name>
        <filter-class>ru.ecom.vjdbccontext.VjdbcContextFilter</filter-class>
        <init-param>
              <param-name>java.naming.provider.url</param-name>
              <param-value>jnp://192.168.3.7:1099/</param-value>
        </init-param>
    </filter>

    <filter-mapping>
        <filter-name>vjdbc-context</filter-name>
        <servlet-name>ViewerServlet</servlet-name>
    </filter-mapping>
    <filter-mapping>
        <filter-name>vjdbc-context</filter-name>
        <servlet-name>EngineServlet</servlet-name>
    </filter-mapping>
}}}